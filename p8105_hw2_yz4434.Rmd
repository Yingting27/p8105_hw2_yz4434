---
title: "Homework"
output: github_document
---

```{r}
library(tidyverse)
```

## Question 2
```{r}
mr_trash_wheel_df = 
  readxl::read_excel("data/202309_Trash_Wheel_Collection_Data.xlsx", sheet = 1, range = "A2:N586") |>
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  mutate(
    homes_powered = weight_tons*500/30,
    trash_wheel_types = "Mr_trash_wheel"
  )
mr_trash_wheel_df$year = as.character(mr_trash_wheel_df$year)
```

# Import, clean, and organize the data for Professor Trash Wheel and Gwynnda

* Professor Trash Wheel

```{r}
prof_trash_wheel_df = 
  readxl::read_excel("data/202309_Trash_Wheel_Collection_Data.xlsx", sheet = 2, range = "A2:M108") |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  mutate(
    homes_powered = weight_tons*500/30,
    trash_wheel_types = "professor_trash_wheel"
  )
prof_trash_wheel_df$year = as.character(prof_trash_wheel_df$year)
```


* Gwynnda Trash Wheel

```{r}
gwy_trash_wheel_df = 
  readxl::read_excel("data/202309_Trash_Wheel_Collection_Data.xlsx", sheet = 4, range = "A2:L157") |> 
  janitor::clean_names() |> 
  drop_na(dumpster) |> 
  mutate(
    homes_powered = weight_tons*500/30,
    trash_wheel_types = "Gwynnda_trash_wheel"
  )
gwy_trash_wheel_df$year = as.character(gwy_trash_wheel_df$year)
```


## Merging

```{r}
combine_sheet_df = 
  bind_rows(mr_trash_wheel_df,prof_trash_wheel_df,gwy_trash_wheel_df) |>
  janitor::clean_names() |> 
  relocate(trash_wheel_types)
```

* Calculate the total number of cigarette butts in 07/2021
```{r}
total_cigarettes = filter(gwy_trash_wheel_df, year == "2021", month == "July")
```


* Descriptions:
According to the results of combine sheet, we can see that there are **`r nrow(combine_sheet_df)` rows**, with **`r ncol(combine_sheet_df)` columns** in total. The key variables include **`r names(combine_sheet_df)`**. The total weight of trash collected by Professor Trash Wheel is **`r sum(prof_trash_wheel_df$weight_tons)`**. The total number of cigarette butts collected by Gwynnda in July of 2021 is **`r sum(total_cigarettes$cigarette_butts)`**

# Question 3

## Import dataset
```{r}
baseline_df =
  read_csv("data/MCI_baseline.csv", skip =1) |> 
  janitor::clean_names() |> 
  filter(current_age < age_at_onset & age_at_onset != ".") |> 
    mutate(
    sex = case_match(
      sex,
      1 ~ "male",
      0 ~ "female"
      )
) |> 
    mutate(
    apoe4 = case_match(
        apoe4,
        1 ~ "APOE4_carrier",
        0 ~ "APOE4_non_carrier"
      )
)
```

* Discuss important steps in the import process and relevant features of the dataset.

At first, I delete the first row as this is label but not data, which is not contained variable names for each column, using **skip function**. Then, I omit the data of those participants who didn't meet the inclusion criteria (the data of current ages are larger than the data of age at onset and those who don't develop MCI), since the study need to follow up participants and to see the situation that thy developed disease, using **filter function to keep data that current_age < age_at_onset and have data with age at onset**. Next, since the original data used numeric data, including 0 and 1 to mention sex and APOE4, I regard 1 as male, 0 as female, and 1 as APOE4 carrier with 0 as APOE4 non-carrier,using **mutate and case_match functions**. After that, there are **`r nrow(baseline_df)`** observations in the merged dataset. The key variables are **`r names(baseline_df)`**.

* How many participants were recruited, and of these how many develop MCI? 

the number of original data
```{r}
total_baseline_df =
  read_csv("data/MCI_baseline.csv", skip =1) |> 
  janitor::clean_names() |> 
  filter (current_age < age_at_onset | age_at_onset == ".") |> 
    mutate(
    sex = case_match(
      sex,
      1 ~ "male",
      0 ~ "female"
      )
) |> 
    mutate(
    apoe4 = case_match(
        apoe4,
        1 ~ "APOE4_carrier",
        0 ~ "APOE4_non_carrier"
      )
)
```
There are `r nrow(total_baseline_df)` participants that were recruited, and `r nrow(baseline_df)` of these develop MCI.

* What is the average baseline age? 
```{r}
baseline_df$age_at_onset = as.numeric(baseline_df$current_age)
```

The average baseline age is `r mean(baseline_df$current_age)`. The proportion of women in the study are APOE4 carriers

* What proportion of women in the study are APOE4 carriers?

```{r}
prop_women = sum(total_baseline_df$sex == "female" & total_baseline_df$apoe4 == "APOE4_carrier") / sum(total_baseline_df$sex == "female")
```

The proportion of `r prop_women` women in the study are APOE4 carriers


# Import, clean, and tidy the dataset of mci_amyloid

```{r}
amyloid_df =
  read_csv("data/mci_amyloid.csv", skip =1) |> 
  janitor::clean_names() |> 
    pivot_longer(
    baseline:time_8,
    names_to = "time",
    values_to = "time_values",
    names_prefix = "time_"
  ) |> 
  mutate(time = replace(time, time == "baseline", "0")
)
```

* Comment on the steps on the import process and the features of the dataset

Firstly, I skip the first row as this line is not the titles of each columns, which
is just a label that is not useful in R studio after importing, using **skip function**. Secondly, I use **pivot function** to make wide format to be long format, which is more convinent to read and compare data. Thirdly, I change the time descriptions by using numeric way, like 0, 2, 4, 6, 8, by using **mutate and replace function**. After doing that, there are **`r nrow(amyloid_df)`** observations in the merged dataset. The key variables are **`r names(amyloid_df)`**.